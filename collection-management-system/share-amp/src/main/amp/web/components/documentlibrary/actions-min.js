(function(){var O=YAHOO.util.Dom,M=YAHOO.util.Event;var L=Alfresco.util.encodeHTML,F=Alfresco.util.combinePaths,E=Alfresco.util.siteURL,R=Alfresco.util.isValueSet;var h;Alfresco.doclib.Actions={};Alfresco.doclib.Actions.prototype={actionsView:null,onRegisterAction:function x(aa,Z){var ab=Z[1];if(ab&&R(ab.actionName)&&R(ab.fn)){this.registerAction(ab.actionName,ab.fn)}else{Alfresco.logger.error("DL_onRegisterAction: Custom action registion invalid: "+ab)}},registerAction:function c(Z,aa){if(R(Z)&&R(aa)){this.constructor.prototype[Z]=aa;return true}return false},renderAction:function Q(aa,ad){var Z=Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/actions/",af='style="background-image:url('+Z+'{icon}-16.png)" ',ac={link:'<div class="{id}"><a title="{label}" class="simple-link" href="{href}" '+af+"{target}><span>{label}</span></a></div>",pagelink:'<div class="{id}"><a title="{label}" class="simple-link" href="{pageUrl}" '+af+"><span>{label}</span></a></div>",javascript:'<div class="{id}" id="{jsfunction}"><a title="{label}" class="action-link" href="#"'+af+"><span>{label}</span></a></div>"};ad.actionParams[aa.id]=aa.params;var ab={id:aa.id,icon:aa.icon,label:L(Alfresco.util.substituteDotNotation(this.msg(aa.label),ad))};if(aa.type==="link"){if(aa.params.href){ab.href=Alfresco.util.substituteDotNotation(aa.params.href,ad);ab.target=aa.params.target?'target="'+aa.params.target+'"':""}else{Alfresco.logger.warn("Action configuration error: Missing 'href' parameter for actionId: ",aa.id)}}else{if(aa.type==="pagelink"){if(aa.params.page){ab.pageUrl=Alfresco.util.substituteDotNotation(aa.params.page,ad);if(aa.params.page.charAt(0)!=="{"){var ae=R(ad.location.site)?ad.location.site.name:null;ab.pageUrl=E(ab.pageUrl,{site:ae})}}else{Alfresco.logger.warn("Action configuration error: Missing 'page' parameter for actionId: ",aa.id)}}else{if(aa.type==="javascript"){if(aa.params["function"]){ab.jsfunction=aa.params["function"]}else{Alfresco.logger.warn("Action configuration error: Missing 'function' parameter for actionId: ",aa.id)}}}}return YAHOO.lang.substitute(ac[aa.type],ab)},getActionUrls:function s(af,aa){var ac=af.jsNode,ai=ac.isLink?ac.linkedNode.nodeRef:ac.nodeRef,ai=ac.isLink&&!R(ai)?"invalidlink":ai,ag=ai.toString(),Z=ai.uri,ae=ac.contentURL,aj=af.workingCopy||{},ab=R(af.location.site)?af.location.site.name:null,ah=Alfresco.util.bind(function(ak){return Alfresco.util.siteURL(ak,{site:YAHOO.lang.isString(aa)?aa:ab})},this),ad={downloadUrl:F(Alfresco.constants.PROXY_URI,ae)+"?a=true",viewUrl:F(Alfresco.constants.PROXY_URI,ae)+'" target="_blank',documentDetailsUrl:ah("document-details?nodeRef="+ag),folderDetailsUrl:ah("folder-details?nodeRef="+ag),editMetadataUrl:ah("edit-metadata?nodeRef="+ag),inlineEditUrl:ah("inline-edit?nodeRef="+ag),managePermissionsUrl:ah("manage-permissions?nodeRef="+ag),manageTranslationsUrl:ah("manage-translations?nodeRef="+ag),workingCopyUrl:ah("document-details?nodeRef="+(aj.workingCopyNodeRef||ag)),workingCopySourceUrl:ah("document-details?nodeRef="+(aj.sourceNodeRef||ag)),cloudViewUrl:F(Alfresco.constants.URL_SERVICECONTEXT,"cloud/cloudUrl?nodeRef="+ag)};if(af.node.type==="ucm:artifact"){ad.documentDetailsUrl=ah("artifact-details?nodeRef="+ag)}ad.sourceRepositoryUrl=this.viewInSourceRepositoryURL(af,ad)+'" target="_blank';return ad},getAction:function Y(aa,Z,ae){var ag=Z.className,ad=Alfresco.util.findInArray(aa.actions,ag,"id")||{};if(ae===false){return ad}else{ad=Alfresco.util.deepCopy(ad);var af=ad.params||{};for(var ab in af){af[ab]=YAHOO.lang.substitute(af[ab],aa,function ac(ai,aj,ah){return Alfresco.util.findValueByDotNotation(aa,ai)})}return ad}},getParentNodeRef:function X(aa){var ad=null;if(YAHOO.lang.isArray(aa)){try{ad=this.doclistMetadata.parent.nodeRef}catch(ae){ad=null}if(ad===null){for(var ac=1,ab=aa.length,Z=true;ac<ab&&Z;ac++){Z=(aa[ac].parent.nodeRef==aa[ac-1].parent.nodeRef)}ad=Z?aa[0].parent.nodeRef:this.doclistMetadata.container}}else{ad=aa.parent.nodeRef}return ad},onActionDetails:function G(ac){var ai=this,ae=ac.nodeRef,ab=ac.jsNode;var ag=function Z(ak,al){var aj='<span class="light">'+L(ac.displayName)+"</span>";Alfresco.util.populateHTML([al.id+"-dialogTitle",ai.msg("edit-details.title",aj)]);this.widgets.editMetadata=Alfresco.util.createYUIButton(al,"editMetadata",null,{type:"link",label:ai.msg("edit-details.label.edit-metadata"),href:E("edit-metadata?nodeRef="+ae)})};var aa=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"node",itemId:ae,mode:"edit",submitType:"json",formId:"doclib-simple-metadata"});var ah=new Alfresco.module.SimpleDialog(this.id+"-editDetails-"+Alfresco.util.generateDomId());ah.setOptions({width:"auto",templateUrl:aa,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:ag,scope:this},onSuccess:{fn:function ad(ak){var am="components/documentlibrary/data";if(R(this.options.siteId)){am+="/site/"+encodeURIComponent(this.options.siteId)}Alfresco.util.Ajax.request({url:F(Alfresco.constants.URL_SERVICECONTEXT,am,"/node/",ab.nodeRef.uri)+"?view="+this.actionsView,successCallback:{fn:function al(ao){var an=ao.json.item;an.jsNode=new Alfresco.util.Node(ao.json.item.node);YAHOO.Bubbling.fire(an.node.isContainer?"folderRenamed":"fileRenamed",{file:an});YAHOO.Bubbling.fire("tagRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.success")});this._updateDocList.call(this)},scope:this},failureCallback:{fn:function aj(an){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}})},scope:this},onFailure:{fn:function af(aj){var ak=this.msg("message.details.failure");if(aj.json&&aj.json.message.indexOf("Failed to persist field 'prop_cm_name'")!==-1){ak=this.msg("message.details.failure.name")}Alfresco.util.PopupManager.displayMessage({text:ak})},scope:this}}).show()},onActionLocate:function W(Z){var ab=Z.jsNode,ad=Z.location.path,aa,ac=R(Z.location.site)?Z.location.site.name:null;if(ab.isLink){aa=R(ab.linkedNode.properties)?ab.linkedNode.properties.name:null;Alfresco.util.PopupManager.displayMessage({text:this.msg("message.actions.failure.locate")})}else{aa=Z.displayName}if(R(this.options.siteId)&&ac!==this.options.siteId){window.location=E((ac===null?"repository":"documentlibrary")+"?file="+encodeURIComponent(aa)+"&path="+encodeURIComponent(ad),{site:ac})}else{this.options.highlightFile=aa;YAHOO.Bubbling.fire("changeFilter",{filterId:"path",filterData:ad})}},onActionDelete:function P(ad){var ah=this,ab=ad.jsNode,ag=ab.isContainer?"folder":"document",aj=ad.displayName,ac=(this.options.syncMode==="CLOUD"),ai=0;var al=this.msg("message.confirm.delete",aj);if(ab.hasAspect("sync:syncSetMemberNode")){if(ac){if(ab.hasAspect("sync:deleteOnPrem")){al+=this.msg("actions.synced.cloud."+ag+".delete.on.prem",aj)}else{al+=this.msg("actions.synced.cloud."+ag+".delete",aj)}}else{al+=this.msg("actions.synced."+ag+".delete",aj)}}if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||O.hasClass(this.id,"alf-fullscreen"))){ai=1000}var ak=undefined;var aa=O.get(this.id);var Z=navigator.userAgent.toLowerCase();if((Z.indexOf("gecko")!=-1||Z.indexOf("safari")!=-1)&&Z.indexOf("chrome")==-1){ak=aa}Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+ag+".delete"),text:al,noEscape:true,zIndex:ai,buttons:[{text:this.msg("button.delete"),handler:function af(){this.destroy();ah._onActionDeleteConfirm.call(ah,ad)}},{text:this.msg("button.cancel"),handler:function ae(){this.destroy()},isDefault:true}]},ak)},_onActionDeleteConfirm:function U(ac){var Z=ac.jsNode,ah=ac.location.path,ab=ac.location.file,aa=F(ah,ab),ae=ac.displayName,af=Z.nodeRef,ad=this.getParentNodeRef(ac);this.modules.actions.genericAction({success:{activity:{siteId:this.options.siteId,activityType:Z.isContainer?"folder-deleted":"file-deleted",page:"documentlibrary",activityData:{fileName:ab,path:ah,nodeRef:af.toString(),parentNodeRef:ad.toString()}},event:{name:Z.isContainer?"folderDeleted":"fileDeleted",obj:{path:aa}},message:this.msg("message.delete.success",ae),callback:{fn:function ag(ai,aj){if(this.totalRecords){this.totalRecords-=ai.json.successCount}},scope:this}},failure:{message:this.msg("message.delete.failure",ae)},webscript:{method:Alfresco.util.Ajax.DELETE,name:"file/node/{nodeRef}",params:{nodeRef:af.uri}},wait:{message:this.msg("message.multiple-delete.please-wait")}})},onActionEditOffline:function b(Z){Alfresco.logger.error("onActionEditOffline","Abstract implementation not overridden")},onlineEditMimetypes:{"application/msword":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word.Document","application/vnd.ms-word.document.macroenabled.12":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"Word.Document","application/vnd.ms-word.template.macroenabled.12":"Word.Document","application/vnd.ms-powerpoint":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.presentation":"PowerPoint.Slide","application/vnd.ms-powerpoint.presentation.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"PowerPoint.Slide","application/vnd.ms-powerpoint.slideshow.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.template":"PowerPoint.Slide","application/vnd.ms-powerpoint.template.macroenabled.12":"PowerPoint.Slide","application/vnd.ms-powerpoint.addin.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slide":"PowerPoint.Slide","application/vnd.ms-powerpoint.slide.macroEnabled.12":"PowerPoint.Slide","application/vnd.ms-excel":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"Excel.Sheet","application/vnd.ms-excel.sheet.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.template.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.addin.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.sheet.binary.macroenabled.12":"Excel.Sheet","application/vnd.visio":"Visio.Drawing"},onActionEditOnline:function l(Z){if(!R(Z.onlineEditUrl)){Z.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,Z.location)}if(Z.onlineEditUrl.length>260){Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"/api/sites/"+Z.location.site.name,successCallback:{fn:function(aa){var ae=aa.json.node.split("/").pop();var ac=Z.nodeRef.split("/").pop();Z.onlineEditUrl=Z.onlineEditUrl.split(Z.location.site.name)[0]+"_IDX_SITE_"+ae+"/_IDX_NODE_"+ac+"/"+Z.displayName;if(Z.onlineEditUrl.length>260){var ab=Z.displayName.split(".").pop();var ad=Z.displayName.split(".")[0];var af=Z.onlineEditUrl.length-260;Z.onlineEditUrl=Z.onlineEditUrl.replace(Z.displayName,ad.substring(0,ad.length-af-1)+"."+ab)}this.actionEditOnlineInternal(Z)},scope:this},failureCallback:{fn:function(aa){this.actionEditOnlineInternal(Z)},scope:this}})}else{this.actionEditOnlineInternal(Z)}},actionEditOnlineInternal:function l(Z){if(Z.onlineEditUrl.length>260){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.path.failure")})}else{if(this._launchOnlineEditor(Z)){YAHOO.Bubbling.fire("metadataRefresh")}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.failure")})}}},_launchOnlineEditor:function A(ad){var ag="SharePoint.OpenDocuments",aa=ad.jsNode,ae=ad.location,ah=aa.mimetype,ab=null,ac=null,Z={doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docm:"application/vnd.ms-word.document.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dotm:"application/vnd.ms-word.template.macroenabled.12",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.template.macroenabled.12",ppam:"application/vnd.ms-powerpoint.addin.macroenabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12"};if(!Alfresco.util.validLocationForOnlineEdit(ae)){Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.invalid",ae.file)});return true}if(this.onlineEditMimetypes.hasOwnProperty(ah)){ab=this.onlineEditMimetypes[ah]}else{var af=Alfresco.util.getFileExtension(ad.location.file);if(af!==null){af=af.toLowerCase();if(Z.hasOwnProperty(af)){ah=Z[af];if(this.onlineEditMimetypes.hasOwnProperty(ah)){ab=this.onlineEditMimetypes[ah]}}}}if(ab!==null){if(!R(ad.onlineEditUrl)){ad.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,ae)}if(YAHOO.env.ua.ie>0){return this._launchOnlineEditorIE(ag,ad,ab)}if(Alfresco.util.isSharePointPluginInstalled()){return this._launchOnlineEditorPlugin(ad,ab)}else{Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.failure",ae.file)});return false}}return window.open(ad.onlineEditUrl,"_blank")},_launchOnlineEditorIE:function H(ab,Z,aa){try{if(aa==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}activeXControl=new ActiveXObject(ab+".3");return activeXControl.EditDocument3(window,Z.onlineEditUrl,true,aa)}catch(ad){try{activeXControl=new ActiveXObject(ab+".2");return activeXControl.EditDocument2(window,Z.onlineEditUrl,aa)}catch(ae){try{activeXControl=new ActiveXObject(ab+".1");return activeXControl.EditDocument(Z.onlineEditUrl,aa)}catch(ac){}}}return false},_launchOnlineEditorPlugin:function f(aa,ab){var ac=document.getElementById("SharePointPlugin");if(ac==null&&Alfresco.util.isSharePointPluginInstalled()){var Z=null;if(YAHOO.env.ua.webkit&&Alfresco.util.isBrowserPluginInstalled("application/x-sharepoint-webkit")){Z="application/x-sharepoint-webkit"}else{Z="application/x-sharepoint"}var ag=document.createElement("object");ag.id="SharePointPlugin";ag.type=Z;ag.width=0;ag.height=0;ag.style.setProperty("visibility","hidden","");document.body.appendChild(ag);ac=document.getElementById("SharePointPlugin");if(!ac){return false}}try{if(ab==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}return ac.EditDocument3(window,aa.onlineEditUrl,true,ab)}catch(ae){try{return ac.EditDocument2(window,aa.onlineEditUrl,ab)}catch(af){try{return ac.EditDocument(aa.onlineEditUrl,ab)}catch(ad){return false}}}},onActionEditOnlineAos:function K(Z){if(!R(Z.onlineEditUrlAos)){Z.onlineEditUrlAos=Alfresco.util.onlineEditUrlAos(this.doclistMetadata.custom.aos,Z)}var ac=Alfresco.util.getFileExtension(Z.location.file);var aa=this.getProtocolForFileExtension(ac);if(aa===undefined){Alfresco.logger.error("onActionEditOnlineAos","No protocol handler available for file extension.");return}var ab=new EmbeddedOfficeLauncher();if(ab.isIOS()){this._aos_launchOfficeOnIos(ab,aa,Z.onlineEditUrlAos);return}if(!ab.isWin()&&!ab.isMac()){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.no_supported_environment")});return}if(ab.isAvailable()){this._aos_launchOfficeByPlugin(ab,Z.onlineEditUrlAos)}else{this._aos_tryToLaunchOfficeByMsProtocolHandler(ab,aa,Z.onlineEditUrlAos)}return},_aos_launchOfficeByPlugin:function w(ad,ab){var aa,af;var ac=(ad.isFirefox()||ad.isChrome()||ad.isSafari());if(!ad.EditDocument(ab)){if(ad.isControlNotActivated()&&ac){aa=window.setInterval(function(){if(ad.isControlActivated()){window.clearInterval(aa);af.destroy();window.setTimeout(function(){if(!ad.EditDocument(ab)){if(ad.getLastControlResult()!==-2){var ag=ad.getLastControlResult()!==false?" (Error code: "+ad.getLastControlResult()+")":"";Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.starting_office_failed")+ag})}}else{YAHOO.Bubbling.fire("metadataRefresh")}},50)}},250);var af=new YAHOO.widget.SimpleDialog("prompt",{close:false,constraintoviewport:true,draggable:false,effect:null,modal:true,visible:true,zIndex:9999});var ae="message.edit-online-aos.plugin_blocked.body.firefox";if(ad.isFirefox()){ae="message.edit-online-aos.plugin_blocked.body.firefox"}else{if(ad.isChrome()){ae="message.edit-online-aos.plugin_blocked.body.chrome"}else{if(ad.isSafari()){ae="message.edit-online-aos.plugin_blocked.body.safari"}}}af.setHeader(this.msg("message.edit-online-aos.plugin_blocked.caption"));af.setBody(this.msg(ae));af.cfg.queueProperty("buttons",[{text:this.msg("message.edit-online-aos.plugin_blocked.button_dismiss"),handler:function(){window.clearInterval(aa);this.destroy()},isDefault:true}]);af.render(document.body);af.center();af.show()}else{if(ad.getLastControlResult()!==-2){var Z=ad.getLastControlResult()!==false?" (Error code: "+ad.getLastControlResult()+")":"";Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.starting_office_failed")+Z})}}}else{YAHOO.Bubbling.fire("metadataRefresh")}},_aos_tryToLaunchOfficeByMsProtocolHandler:function S(af,ad,ac){var Z=ad+":ofe%7Cu%7C"+ac;var ae=false;var aa=document.createElement("input");var ab=document.body.scrollTop+10;aa.setAttribute("style","z-index: 1000; background-color: rgba(0, 0, 0, 0); border: none; outline: none; position: absolute; left: 10px; top: "+ab+"px;");document.getElementsByTagName("body")[0].appendChild(aa);aa.focus();aa.onblur=function(){ae=true};location.href=Z;setTimeout(function(){aa.onblur=null;aa.remove();if(!ae){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.supported_office_version_required")})}},500)},_aos_launchOfficeOnIos:function u(ad,ab,aa){var Z=ab+":ofe%7Cu%7C"+ad.encodeUrl(aa);var ac=document.createElement("iframe");ac.setAttribute("style","display: none; height: 0; width: 0;");document.getElementsByTagName("body")[0].appendChild(ac);ac.src=Z},getProtocolForFileExtension:function(aa){var Z={doc:"ms-word",docx:"ms-word",docm:"ms-word",dot:"ms-word",dotx:"ms-word",dotm:"ms-word",xls:"ms-excel",xlsx:"ms-excel",xlsb:"ms-excel",xlsm:"ms-excel",xlt:"ms-excel",xltx:"ms-excel",xltm:"ms-excel",xlsm:"ms-excel",ppt:"ms-powerpoint",pptx:"ms-powerpoint",pot:"ms-powerpoint",potx:"ms-powerpoint",potm:"ms-powerpoint",pptm:"ms-powerpoint",potm:"ms-powerpoint",pps:"ms-powerpoint",ppsx:"ms-powerpoint",ppam:"ms-powerpoint",ppsm:"ms-powerpoint",sldx:"ms-powerpoint",sldm:"ms-powerpoint"};return Z[aa]},onActionSimpleRepoAction:function e(ae,aa){if(aa.title.indexOf("_deactivated")==-1){var ac=this.getAction(ae,aa).params,ai=ae.displayName,ah=["function","action","success","successMessage","failure","failureMessage"],af={};for(var Z in ac){if(ac.hasOwnProperty(Z)&&!Alfresco.util.arrayContains(ah,Z)){af[Z]=ac[Z]}}var ag=aa.title;aa.title=aa.title+"_deactivated";var ab={success:{event:{name:"metadataRefresh",obj:ae}},failure:{message:this.msg(ac.failureMessage,ai),fn:function ad(){aa.title=ag},scope:this},webscript:{method:Alfresco.util.Ajax.POST,stem:Alfresco.constants.PROXY_URI+"api/",name:"actionQueue"},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{actionedUponNode:ae.nodeRef,actionDefinitionName:ac.action,parameterValues:af}}};if(YAHOO.lang.isFunction(this[ac.success])){ab.success.callback={fn:this[ac.success],obj:ae,scope:this}}if(ac.successMessage){ab.success.message=this.msg(ac.successMessage,ai)}if(YAHOO.lang.isFunction(this[ac.failure])){ab.failure.callback={fn:this[ac.failure],obj:ae,scope:this}}if(ac.failureMessage){ab.failure.message=this.msg(ac.failureMessage,ai)}this.modules.actions.genericAction(ab)}},onActionFormDialog:function n(ab,Z){var ad=this.getAction(ab,Z),af=ad.params,ac={title:this.msg(ad.label)},aa=ab.displayName;delete af["function"];var ae=af.success;delete af.success;ac.success={fn:function(ag,ah){if(YAHOO.lang.isFunction(this[ae])){this[ae].call(this,ag,ah)}YAHOO.Bubbling.fire("metadataRefresh",ah)},obj:ab,scope:this};if(af.successMessage){ac.successMessage=this.msg(af.successMessage,aa);delete af.successMessage}if(YAHOO.lang.isFunction(this[af.failure])){ac.failure={fn:this[af.failure],obj:ab,scope:this};delete af.failure}if(af.failureMessage){ac.failureMessage=this.msg(af.failureMessage,aa);delete af.failureMessage}ac.properties=af;Alfresco.util.PopupManager.displayForm(ac)},onActionUploadNewVersion:function k(ab){var aa=ab.jsNode,af=ab.displayName,ag=aa.nodeRef,ac=ab.version;if(!this.fileUpload){this.fileUpload=Alfresco.getFileUploadInstance()}var ah=this.msg("label.filter-description",af),ad="*";if(af&&new RegExp(/[^\.]+\.[^\.]+/).exec(af)){ad="*"+af.substring(af.lastIndexOf("."))}if(ab.workingCopy&&ab.workingCopy.workingCopyVersion){ac=ab.workingCopy.workingCopyVersion}var ae=0;if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||O.hasClass(this.id,"alf-fullscreen"))){ae=1000}var Z={updateNodeRef:ag.toString(),updateFilename:af,updateVersion:ac,overwrite:true,filter:[{description:ah,extensions:ad}],mode:this.fileUpload.MODE_SINGLE_UPDATE,onFileUploadComplete:{fn:this.onNewVersionUploadComplete,scope:this}};this.fileUpload.options.zIndex=ae;if(R(this.options.siteId)){Z.siteId=this.options.siteId;Z.containerId=this.options.containerId}this.fileUpload.show(Z)},_uploadComplete:function N(Z,ad){var ae=Z.successful.length,aa,ac;if(ae>0){if(ae<(this.options.groupActivitiesAt||5)){for(var ab=0;ab<ae;ab++){ac=Z.successful[ab];aa={fileName:ac.fileName,nodeRef:ac.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-"+ad,"document-details",aa)}}else{aa={fileCount:ae,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-"+ad,"documentlibrary",aa)}}},onFileUploadComplete:function p(Z){this._uploadComplete(Z,"added")},onNewVersionUploadComplete:function y(Z){this._uploadComplete(Z,"updated")},onActionCancelEditing:function j(aa){var Z=aa.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.edit-cancel.success",Z)},failure:{message:this.msg("message.edit-cancel.failure",Z)},webscript:{method:Alfresco.util.Ajax.POST,name:"cancel-checkout/node/{nodeRef}",params:{nodeRef:aa.jsNode.nodeRef.uri}}});YAHOO.Bubbling.fire("editingCanceled",{record:aa})},onActionCopyTo:function i(Z){this._copyMoveTo("copy",Z)},onActionMoveTo:function g(Z){this._copyMoveTo("move",Z)},_copyMoveTo:function D(ac,aa){if(!ac in {copy:true,move:true}){throw new Error("'"+ac+"' is not a valid Copy/Move to mode.")}if(!this.modules.copyMoveTo){this.modules.copyMoveTo=new Alfresco.module.DoclibCopyMoveTo(this.id+"-copyMoveTo")}var ab=Alfresco.module.DoclibGlobalFolder;var Z=[ab.VIEW_MODE_RECENT_SITES,ab.VIEW_MODE_FAVOURITE_SITES,ab.VIEW_MODE_SITE,ab.VIEW_MODE_SHARED];if(this.options.repositoryBrowsing===true){Z.push(ab.VIEW_MODE_REPOSITORY)}Z.push(ab.VIEW_MODE_USERHOME);var ad=0;if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||O.hasClass(this.id,"alf-fullscreen"))){ad=1000}this.modules.copyMoveTo.setOptions({allowedViewModes:Z,mode:ac,siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:aa,rootNode:this.options.rootNode,parentId:this.getParentNodeRef(aa),zIndex:ad}).showDialog()},onActionAssignWorkflow:function d(aa){var ae="",Z=this.getParentNodeRef(aa);if(YAHOO.lang.isArray(aa)){for(var ac=0,ab=aa.length;ac<ab;ac++){ae+=(ac===0?"":",")+aa[ac].nodeRef}}else{ae=aa.nodeRef}var ad={selectedItems:ae};if(Z){ad.destination=Z}Alfresco.util.navigateTo(E("start-workflow"),"POST",ad)},onActionManagePermissions:function J(Z){if(!this.modules.permissions){this.modules.permissions=new Alfresco.module.DoclibPermissions(this.id+"-permissions")}this.modules.permissions.setOptions({siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:Z}).showDialog()},onActionManageAspects:function r(Z){if(!this.modules.aspects){this.modules.aspects=new Alfresco.module.DoclibAspects(this.id+"-aspects")}this.modules.aspects.setOptions({file:Z}).show()},onActionChangeType:function q(ad){var Z=ad.jsNode,ae=Z.type,ag=ad.displayName,aa=Alfresco.constants.PROXY_URI+F("slingshot/doclib/type/node",Z.nodeRef.uri);var ah=function ac(aj){aj.addValidation(this.id+"-changeType-type",function ai(ap,al,ao,an,ak,am){return ap.options[ap.selectedIndex].value!=="-"},null,"change",null,{validationType:"mandatory"})};this.modules.changeType=new Alfresco.module.SimpleDialog(this.id+"-changeType").setOptions({width:"30em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/change-type?currentType="+encodeURIComponent(ae),actionUrl:aa,doSetupFormsValidation:{fn:ah,scope:this},firstFocus:this.id+"-changeType-type",onSuccess:{fn:function af(ai){YAHOO.Bubbling.fire("metadataRefresh",{highlightFile:ag});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.success",ag)})},scope:this},onFailure:{fn:function ab(ai){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.failure",ag)})},scope:this}});this.modules.changeType.show()},viewInSourceRepositoryURL:function o(ab,ad){var ac=ab.node,aa=ab.location.repositoryId,Z=this.options.replicationUrlMapping,ae;if(!aa||!Z||!Z[aa]){return"#"}ae=ac.isContainer?ad.folderDetailsUrl:ad.documentDetailsUrl;ae=ae.substring(Alfresco.constants.URL_CONTEXT.length);return F(Z[aa],"/",ae)},onActionCloudSync:function T(Z){if(!h){h=new Alfresco.module.DoclibCloudFolder(this.id+"-cloud-folder");var ab=this;YAHOO.Bubbling.on("folderSelected",function ac(af,ae){this.updateSyncOptions();Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetdefinitions",dataObj:YAHOO.lang.merge(this.options.syncOptions,{memberNodeRefs:ab.getMemberNodeRefs(this.options.files),remoteTenantId:this.options.targetNetwork,targetFolderNodeRef:ae[1].selectedFolder.nodeRef}),successCallback:{fn:function ag(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.sync.success")})},scope:this},failureMessage:this.msg("message.sync.failure")})},h)}else{var ad=h.widgets.optionInputs;if(ad){for(var aa=0;aa<ad.length;aa++){ad[aa].checked=ad[aa].defaultChecked}}}if(!this.modules.cloudAuth){this.modules.cloudAuth=new Alfresco.module.CloudAuth(this.id+"cloudAuth")}h.setOptions({files:Z});this.modules.cloudAuth.setOptions({authCallback:h.showDialog,authCallbackContext:h}).checkAuth()},onActionCloudUnsync:function C(ab){var ag=this,af=ab.jsNode.isContainer?"folder":"document",aa=ab.displayName,ae=(this.options.syncMode==="CLOUD"),Z=ae?"":'<div><input type="checkbox" id="requestDeleteRemote" class="requestDeleteRemote-checkBox"><span class="requestDeleteRemote-text">'+this.msg("sync.remove."+af+".from.cloud",aa)+"</span></div>";Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+af+".cloud-unsync"),noEscape:true,text:this.msg("message.unsync.confirm",aa)+Z,buttons:[{text:this.msg("button.unsync"),handler:function ac(){var ah=ae?false:O.getAttribute("requestDeleteRemote","checked");this.destroy();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetmembers/"+ab.jsNode.nodeRef.uri+"?requestDeleteRemote="+ah,method:Alfresco.util.Ajax.DELETE,successCallback:{fn:function ai(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:ag.msg("message.unsync.success")})},scope:ag},failureMessage:ag.msg("message.unsync.failure")})}},{text:this.msg("button.cancel"),handler:function ad(){this.destroy()},isDefault:true}]})},onCloudSyncIndicatorAction:function z(Z,ad){var ab=new Alfresco.util.createInfoBalloon(this.widgets.dataTable.getTrEl(ad),{text:this.msg("label.loading"),width:"455px"});ab.show();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/node/"+Z.nodeRef.replace("://","/"),successCallback:{fn:function ac(af){var ag=this,ae={showTitle:true,showRequestSyncButton:true,showUnsyncButton:true,showMoreInfoLink:true};Alfresco.util.getSyncStatus(this,Z,af.json,ae,function(ai){if(ai!=null){ab.html(ai.html);ab.requestsync=Alfresco.util.createYUIButton(ag,"button-requestsyn",function(){ag.onActionCloudSyncRequest(Z);ab.hide()},{id:ag.id});if(!ai.showRequestSyncButton&&ab.requestsync!=null){ab.requestsync.setStyle("display","none")}ab.unsync=Alfresco.util.createYUIButton(ag,"button-unsync",function(){ag.onActionCloudUnsync(Z);ab.hide()},{id:ag.id});if(!ai.showUnsyncButton&&ab.unsync!=null){ab.unsync.setStyle("display","none")}var ah=ab.content;Alfresco.util.syncClickOnShowDetailsLinkEvent(ag,ah);Alfresco.util.syncClickOnHideLinkEvent(ag,ah);Alfresco.util.syncClickOnTransientErrorShowDetailsLinkEvent(ag,ah);Alfresco.util.syncClickOnTransientErrorHideLinkEvent(ag,ah)}else{ab.hide()}})},scope:this},failureCallback:{fn:function aa(ae){Alfresco.util.PopupManager.displayMessage({text:this.msg("sync.unable.get.details")})},scope:this}})},onActionCloudSyncRequest:function v(Z,ab){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncrequest",dataObj:{memberNodeRefs:this.getMemberNodeRefs(Z)},successCallback:{fn:function aa(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.request.sync.success")})},scope:this},failureMessage:this.msg("message.request.sync.failure")})},getMemberNodeRefs:function a(Z){var ab=new Array();if(YAHOO.lang.isArray(Z)){for(var aa in Z){ab.push(Z[aa].nodeRef)}}else{ab.push(Z.nodeRef)}return ab},onCloudSyncFailedIndicatorAction:function B(Z,aa){this.onCloudSyncIndicatorAction(Z,aa)},onCloudIndirectSyncIndicatorAction:function V(Z,aa){this.onCloudSyncIndicatorAction(Z,aa)},onCloudIndirectSyncFailedIndicatorAction:function I(Z,aa){this.onCloudSyncIndicatorAction(Z,aa)},onActionFolderDownload:function t(Z){var aa=Alfresco.getArchiveAndDownloadInstance(),ab={nodesToArchive:[{nodeRef:Z.nodeRef}],archiveName:Z.fileName};aa.show(ab)},onActionDownload:function m(Z){var aa=Alfresco.getArchiveAndDownloadInstance(),ab={nodesToArchive:[]};if(Z.length==1){ab.nodesToArchive.push({nodeRef:Z[0].nodeRef});ab.archiveName=Z[0].fileName}else{for(var ac=0;ac<Z.length;ac++){ab.nodesToArchive.push({nodeRef:Z[ac].nodeRef})}}aa.show(ab)}}})();